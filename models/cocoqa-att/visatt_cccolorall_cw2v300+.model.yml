costFn: 'crossEntIdx'
decisionFn: 'argmax'
stages:
    - 'imgSel'
    - 'objSel'
    - 'imgFeat'
    - 'txtDict'
    - 'imgReshape'
    - 'avgAtt'
    - 'avgAttReshape'
    - 'avgCtx'
    - 'attHid1'
    - 'attOut'
    - 'attReshape'
    - 'attCtx'
    - 'answer'
outputs: 'answer'
specs:
    - name: 'imgSel'
      type: 'selector'
      inputs: 'input'
      start: 0
      end: 1
      axis: 1
    - name: 'objSel'
      type: 'selector'
      inputs: 'input'
      start: 7
      end: 8
      axis: 1
    - name: 'imgFeat'
      type: 'lut'
      inputs: 'imgSel'
      inputDim: 123287
      outputDim: 100352
      initWeights: '/ais/gobi3/u/mren/data/cocoqa-full/hidden_oxford.h5'
      format: 'h5'
      h5key: 'hidden5_4_conv'
      sparse: true
      learningRate: 0.0
      outputdEdX: false
    - name: 'imgReshape'
      type: 'reshape'
      inputs: 'imgFeat'
      reshapeFn: '(x[0], 196, x[1]/196)'
      outputDim: 512
    - name: 'txtDict'
      type: 'lut'
      inputs: 'objSel'
      inputDim: 2394
      outputDim: 300
      initWeights: '../data/cocoqa-color-all/word-embed-q.npy'
      learningRate: 0.8
      momentum: 0.9
      gradientClip: 0.1
      weightClip: 500.0
      outputdEdX: false
    - name: 'avgAtt'
      type: 'constValue'
      inputs: 'imgReshape'
      outputDim: 196
      value: 0.00510204082
    - name: 'avgAttReshape'
      type: 'reshape'
      inputs: 'avgAtt'
      reshapeFn: '(x[0], x[1], 1)'
      outputDim: 196
    - name: 'avgCtx'
      type: 'sumProd'
      inputs: 'avgAttReshape, imgReshape'
      sumAxis: 1
      outputDim: 512
    - name: 'attHid1'
      type: 'map'
      inputs: 'txtDict, avgCtx'
      outputDim: 300
      activeFn: 'tanh'
      initRange: 0.05
      initSeed: 6
      learningRate: 0.1
      momentum: 0.9
      gradientClip: 0.1
      weightClip: 50
      weightRegConst: 0.000005
    - name: 'attOut'
      type: 'map'
      inputs: 'attHid1'
      outputDim: 196
      activeFn: 'softmax'
      initRange: 0.1
      initSeed: 7
      learningRate: 0.1
      momentum: 0.9
      gradientClip: 0.1
      weightClip: 50.0
      weightRegConst: 0.000005
    - name: 'attReshape'
      type: 'reshape'
      inputs: 'attOut'
      reshapeFn: '(x[0], x[1], 1)'
      outputDim: 196
    - name: 'attCtx'
      type: 'sumProd'
      inputs: 'attReshape, imgReshape'
      sumAxis: 1
      outputDim: 512
    - name: 'answer'
      type: 'map'
      inputs: 'attCtx'
      outputDim: 12
      activeFn: 'softmax'
      initRange: 0.1
      initSeed: 6
      learningRate: 0.01
      momentum: 0.9
      gradientClip: 0.1
      weightClip: 10.0
      weightRegConst: 0.000005